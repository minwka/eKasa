<Project Sdk="Microsoft.NET.Sdk">

  <PropertyGroup>
    <OutputType>WinExe</OutputType>
    <TargetFramework>net5.0-windows</TargetFramework>
    <UseWPF>true</UseWPF>
    <ApplicationIcon>logo.ico</ApplicationIcon>
    <PackageId>eKasa Installer</PackageId>
    <Company>NAMI</Company>
    <Authors>NAMI</Authors>
    <Product>eKasa Installer</Product>
    <AssemblyVersion>3.0.0.0</AssemblyVersion>
    <FileVersion>3.0.0.0</FileVersion>
    <Version>3.0.0</Version>
    <AssemblyName>Installer</AssemblyName>
    <ApplicationManifest>app.manifest</ApplicationManifest>
  </PropertyGroup>

  <ItemGroup>
    <None Remove="Controls\ekasa_logo.png" />
  </ItemGroup>

  <ItemGroup>
    <COMReference Include="IWshRuntimeLibrary">
      <WrapperTool>tlbimp</WrapperTool>
      <VersionMinor>0</VersionMinor>
      <VersionMajor>1</VersionMajor>
      <Guid>f935dc20-1cf0-11d0-adb9-00c04fd58a0b</Guid>
      <Lcid>0</Lcid>
      <Isolated>false</Isolated>
      <EmbedInteropTypes>true</EmbedInteropTypes>
    </COMReference>
  </ItemGroup>

  <ItemGroup>
    <Resource Include="Controls\ekasa_logo.png" />
  </ItemGroup>

  <ItemGroup>
    <None Update="Binaries\7z\7za.dll">
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
    </None>
    <None Update="Binaries\7z\7za.exe">
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
    </None>
    <None Update="Binaries\7z\7zxa.dll">
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
    </None>
  </ItemGroup>

  <ItemGroup>
    <Folder Include="Binaries\Install\" />
  </ItemGroup>

  <ItemGroup>
    <PackageReference Include="WindowsAPICodePack-Core" Version="1.1.2" />
    <PackageReference Include="WindowsAPICodePack-Shell" Version="1.1.1" />
  </ItemGroup>

  <Target Name="PreBuild" BeforeTargets="PreBuildEvent">
    <Exec Command="cmd /c &quot;rd ..\Installer /S /Q&quot;&#xD;&#xA;cmd /c &quot;rd bin /S /Q&quot;&#xD;&#xA;cmd /c &quot;erase Binaries\Install\files.7z /Q&quot;&#xD;&#xA;cmd /c &quot;echo cleaned package file&quot;" />
  </Target>

  <Target Name="PostBuild" AfterTargets="PostBuildEvent">
    <Exec Command="cmd /c &quot;cd Binaries\Install &amp;&amp; ..\7z\7za.exe a -t7z -m0=lzma2 -mx=9 -mfb=64 -md=32m -ms=on -mhe=on -p&quot;enc765_-_-_inst05&quot; files.7z *&quot;&#xD;&#xA;cmd /c &quot;mkdir bin\Release\net5.0-windows\Binaries\Install&quot;&#xD;&#xA;cmd /c &quot;echo created destination package directory&quot;&#xD;&#xA;cmd /c &quot;copy Binaries\Install\files.7z bin\Release\net5.0-windows\Binaries\Install\package.7z&quot;&#xD;&#xA;cmd /c &quot;echo copied package&quot;&#xD;&#xA;cmd /c &quot;erase Binaries\Install\* /Q&quot;&#xD;&#xA;cmd /c &quot;echo cleaned package directory&quot;&#xD;&#xA;cmd /c &quot;mkdir ..\Installer&quot;&#xD;&#xA;cmd /c &quot;cd bin\Release\net5.0-windows &amp;&amp; xcopy Binaries ..\..\..\..\Installer\Binaries\ /E /Q&quot;&#xD;&#xA;cmd /c &quot;cd bin\Release\net5.0-windows &amp;&amp; copy Installer.exe ..\..\..\..\Installer\Installer.exe&quot;&#xD;&#xA;cmd /c &quot;cd bin\Release\net5.0-windows &amp;&amp; copy Installer.dll ..\..\..\..\Installer\Installer.dll&quot;&#xD;&#xA;cmd /c &quot;cd bin\Release\net5.0-windows &amp;&amp; copy Installer.runtimeconfig.json ..\..\..\..\Installer\Installer.runtimeconfig.json&quot;&#xD;&#xA;cmd /c &quot;cd bin\Release\net5.0-windows &amp;&amp; copy Microsoft.WindowsAPICodePack.dll ..\..\..\..\Installer\Microsoft.WindowsAPICodePack.dll&quot;&#xD;&#xA;cmd /c &quot;cd bin\Release\net5.0-windows &amp;&amp; copy Microsoft.WindowsAPICodePack.Shell.dll ..\..\..\..\Installer\Microsoft.WindowsAPICodePack.Shell.dll&quot;" />
  </Target>

</Project>
